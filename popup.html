<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TradingView Strategy Optimiser</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="popup-container">
    <header class="popup-header">
      <h1>TradingView Strategy Optimiser</h1>
      <p>Optimise strategy parameters using Bayesian optimisation</p>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button id="setupTab" class="tab-btn active" data-tab="setup">
        <span>âš™ï¸</span> Setup
      </button>
      <button id="optimiseTab" class="tab-btn" data-tab="optimise">
        <span>ğŸ¯</span> Optimise
      </button>
      <button id="resultsTab" class="tab-btn" data-tab="results">
        <span>ğŸ“Š</span> Results
      </button>
    </nav>

    <!-- Tab Contents -->
    <div class="tab-content">
      <!-- Setup Tab -->
      <div id="setupTabContent" class="tab-pane active">
        <div class="setup-section">
          <h3>Strategy Selection:</h3>
          <div class="strategy-selection">
            <div class="dropdown-container">
              <select id="strategyDropdown" class="strategy-dropdown">
                <option value="">Loading strategies...</option>
              </select>
              <button id="refreshStrategiesBtn" class="btn btn-secondary refresh-btn">
                <span>ğŸ”„</span>
              </button>
            </div>
          </div>
        </div>

        <div class="strategy-settings-section hidden" id="strategySettingsSection">
          <div class="saved-configs-section" id="savedConfigsSection">
            <h3>Saved Configurations:</h3>
            <div class="saved-configs-controls">
              <select id="savedConfigsDropdown" class="saved-configs-dropdown">
                <option value="">Select a saved configuration...</option>
              </select>
              <div class="saved-configs-buttons">
                <button id="loadConfigBtn" class="btn btn-secondary" disabled>
                  <span>ğŸ“‚</span> Load
                </button>
                <button id="deleteConfigBtn" class="btn btn-danger" disabled>
                  <span>ğŸ—‘ï¸</span> Delete
                </button>
              </div>
            </div>
            
            <div class="save-new-config-section">
              <h4>Save New Configuration:</h4>
              <div class="config-inputs">
                <div class="config-input-group">
                  <label for="configName">Configuration Name:</label>
                  <input type="text" id="configName" class="config-input" placeholder="Enter configuration name...">
                </div>
                <div class="config-input-group">
                  <label for="configDescription">Description (optional):</label>
                  <input type="text" id="configDescription" class="config-input" placeholder="Enter description...">
                </div>
              </div>
              <div class="config-actions">
                <button id="saveAsNewConfigBtn" class="btn btn-secondary" disabled>
                  <span>ğŸ’¾</span> Save as New Configuration
                </button>
                <button id="saveOptimisationConfig" class="btn btn-primary" disabled>
                  <span>âœ…</span> Apply Configuration
                </button>
              </div>
            </div>
          </div>
          
          <div class="optimisation-params-section" id="optimisationParamsSection">
            <h3>Optimisation Parameters:</h3>
            <p class="section-description">Select which parameters to optimise and set their value ranges:</p>
            <div id="optimisationParams" class="optimisation-params">
              <!-- Optimisation parameters will be populated here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Optimise Tab -->
      <div id="optimiseTabContent" class="tab-pane hidden">
        <div class="optimise-section">
          <h3>Optimisation Configuration:</h3>
          
          <div class="config-group">
            <label for="metricDropdown">Optimisation Metric:</label>
            <select id="metricDropdown" class="metric-dropdown">
              <option value="">Select metric to optimise...</option>
            </select>
          </div>

          <div class="config-group">
            <label for="iterationsInput">Number of Iterations:</label>
            <input type="number" id="iterationsInput" class="iterations-input" min="1" max="1000" placeholder="e.g., 100">
          </div>

          <div class="config-group">
            <label class="toggle-label">
              <span>Use Custom Date Range</span>
              <div class="toggle-container">
                <input type="checkbox" id="dateRangeEnabled" class="toggle-input">
                <span class="toggle-slider"></span>
              </div>
            </label>
            
            <div class="date-inputs hidden" id="dateInputs">
              <div class="date-input-group">
                <label for="startDate">Start Date:</label>
                <input type="date" id="startDate" class="date-input">
              </div>
              <div class="date-input-group">
                <label for="endDate">End Date:</label>
                <input type="date" id="endDate" class="date-input">
              </div>
            </div>
          </div>

          <div class="config-group">
            <h4>Anti-Detection Delays:</h4>
            <div class="delay-inputs">
              <div class="delay-input-group">
                <label for="minDelay">Min Delay (ms):</label>
                <input type="number" id="minDelay" class="delay-input" min="0" value="100" placeholder="e.g., 100">
              </div>
              <div class="delay-input-group">
                <label for="maxDelay">Max Delay (ms):</label>
                <input type="number" id="maxDelay" class="delay-input" min="0" value="500" placeholder="e.g., 500">
              </div>
            </div>
          </div>

          <div class="config-group">
            <h4>Add Filter:</h4>
            <div class="filter-add-section">
              <select id="filterMetricDropdown" class="filter-metric-dropdown">
                <option value="">Select metric to filter...</option>
              </select>
              <div class="filter-value-inputs">
                <input type="number" id="filterMinValue" class="filter-value-input" placeholder="Min value (optional)">
                <input type="number" id="filterMaxValue" class="filter-value-input" placeholder="Max value (optional)">
              </div>
              <button id="addFilterBtn" class="btn btn-secondary">
                <span>â•</span> Add Filter
              </button>
            </div>
          </div>

          <div class="active-filters-section">
            <h4>Active Filters:</h4>
            <div id="activeFilters" class="active-filters">
              <div class="no-filters">No filters applied</div>
            </div>
          </div>

          <div class="optimisation-actions">
            <button id="startOptimisationBtn" class="btn btn-primary btn-large" disabled>
              <span>ğŸš€</span> Start Optimisation
            </button>
          </div>
        </div>
      </div>

      <!-- Results Tab -->
      <div id="resultsTabContent" class="tab-pane hidden">
        <div class="results-section">
          <div class="best-results-section">
            <h3>Current/Final Best Results:</h3>
            <div id="bestResults" class="best-results">
              <div class="no-results">No optimisation results yet</div>
            </div>
          </div>

          <div class="action-buttons-section hidden" id="actionButtonsSection">
            <div class="action-buttons">
              <button id="applyBestBtn" class="btn btn-primary">
                <span>âœ…</span> Apply Best
              </button>
              <button id="exportCsvBtn" class="btn btn-secondary">
                <span>ğŸ“„</span> Export CSV
              </button>
              <button id="exportJsonBtn" class="btn btn-secondary">
                <span>ğŸ“‹</span> Export JSON
              </button>
            </div>
          </div>

          <div class="all-results-section">
            <h3>All Results:</h3>
            <div id="allResults" class="all-results">
              <div class="no-results">No optimisation results yet</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="status" class="status info">Ready - Please select the Setup tab to begin</div>

    <footer class="popup-footer">
      <small>TradingView Strategy Optimiser v1.0</small>
    </footer>
  </div>

  <script src="popup.js"></script>
</body>
</html>
